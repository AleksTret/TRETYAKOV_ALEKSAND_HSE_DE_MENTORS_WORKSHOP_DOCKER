# URL Shortener Service

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è –¥–ª–∏–Ω–Ω—ã—Ö URL-–∞–¥—Ä–µ—Å–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º FastAPI –∏ SQLite, —É–ø–∞–∫–æ–≤–∞–Ω–Ω—ã–π –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
- [–û–ø–∏—Å–∞–Ω–∏–µ](#–æ–ø–∏—Å–∞–Ω–∏–µ)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
- [–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API](#–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ-api)
  - [–ß–µ—Ä–µ–∑ curl](#—á–µ—Ä–µ–∑-curl)
  - [–ß–µ—Ä–µ–∑ Postman](#—á–µ—Ä–µ–∑-postman)
  - [–ß–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä](#—á–µ—Ä–µ–∑-–±—Ä–∞—É–∑–µ—Ä)
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API](#–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è-api)
- [–î–∞–Ω–Ω—ã–µ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ](#–¥–∞–Ω–Ω—ã–µ-–∏-—Ö—Ä–∞–Ω–µ–Ω–∏–µ)
- [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º](#—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º)

## –û–ø–∏—Å–∞–Ω–∏–µ

–°–µ—Ä–≤–∏—Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç REST API –¥–ª—è:
- –°–æ–∑–¥–∞–Ω–∏—è –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å—Å—ã–ª–æ–∫ –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö URL
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ –∫–æ—Ä–æ—Ç–∫–∏–º —Å—Å—ã–ª–∫–∞–º
- –ü—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ —Å–æ–∑–¥–∞–Ω–Ω—ã–º —Å—Å—ã–ª–∫–∞–º

–î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ SQLite –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä–∞—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å –ø–æ–º–æ—â—å—é Docker volume.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
task_final/ 
‚îú‚îÄ‚îÄ docker-compose.yml       # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Docker Compose
‚îî‚îÄ‚îÄ shorturl/                # –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º
    ‚îú‚îÄ‚îÄ app.py               # FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (—Ä–æ—É—Ç–∏–Ω–≥)
    ‚îú‚îÄ‚îÄ model.py             # –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –ë–î
    ‚îú‚îÄ‚îÄ dockerfile           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Docker –æ–±—Ä–∞–∑–∞
    ‚îî‚îÄ‚îÄ requirements.txt     # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
```

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:

```bash
git clone https://github.com/AleksTret/TRETYAKOV_ALEKSAND_HSE_DE_MENTORS_WORKSHOP_DOCKER.git
cd .\task_final\
```
–ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose

- –í–∞—Ä–∏–∞–Ω—Ç A: –ó–∞–ø—É—Å–∫ —Å –ª–æ–≥–∞–º–∏ 
    ``` 
    docker compose up --build 
    ```
- –í–∞—Ä–∏–∞–Ω—Ç B: –ó–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
    ```
    docker compose up -d --build
    ```
–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ –∞–¥—Ä–µ—Å—É:

```
http://localhost:8080/
```
–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ curl:
```
curl http://localhost:8080/
```
–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è –æ—Ç–≤–µ—Ç:
```json
{
  "service": "URL Shortener",
  "endpoints": {
    "POST /shorten": "–°–æ–∑–¥–∞—Ç—å –∫–æ—Ä–æ—Ç–∫—É—é —Å—Å—ã–ª–∫—É",
    "GET /{short_id}": "–ü–µ—Ä–µ–π—Ç–∏ –ø–æ –∫–æ—Ä–æ—Ç–∫–æ–π —Å—Å—ã–ª–∫–µ",
    "GET /stats/{short_id}": "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å—Å—ã–ª–∫–µ"
  }
}
```
![–û–ø–∏—Å–∞–Ω–∏–µ](./assets/2025-12-18%20164826.jpg)
–û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–∞
```
docker compose down
```
## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API

### –ß–µ—Ä–µ–∑ curl
- 1. –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ—Ä–æ—Ç–∫–æ–π —Å—Å—ã–ª–∫–∏
    ```bash
    curl -X POST "http://localhost:8080/shorten" -H "Content-Type: application/json" -d "{\"url\": \"https://google.com\"}"
    ```     
    –û—Ç–≤–µ—Ç:

    ```json
    {
    "short_id": "37fad5",
    "short_url": "/37fad5"
    }
    ```
    ![–û–ø–∏—Å–∞–Ω–∏–µ](./assets/2025-12-18%20164909.jpg)

- 2. –ü–µ—Ä–µ—Ö–æ–¥ –ø–æ –∫–æ—Ä–æ—Ç–∫–æ–π —Å—Å—ã–ª–∫–µ
    ```bash
    # –° —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–º (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π URL)
    curl -L "http://localhost:8080/37fad5"
    ```

    ![–û–ø–∏—Å–∞–Ω–∏–µ](./assets/2025-12-18%20170557.jpg)
- 3. –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

    ```bash
    curl "http://localhost:8080/stats/37fad5"
    ```
    –û—Ç–≤–µ—Ç:
    ![–û–ø–∏—Å–∞–Ω–∏–µ](./assets/2025-12-18%20165338.jpg)

    ```json
    {
    "short_id": "37fad5",
    "original_url": "https://google.com",
    "created_at": "2025-12-18 08:37:00",
    "click_count": 3
    }
    ```
## –ß–µ—Ä–µ–∑ Postman
- 1. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ URL
    –ú–µ—Ç–æ–¥: POST
    ```
    URL: http://localhost:8080/shorten
    ```
    Headers:
    ```
    Content-Type: application/json
    ```
    Body (raw JSON):
    ```json
    {
      "url": "https://google.com"
    }
    ```
- 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞
    –ú–µ—Ç–æ–¥: GET
    ```
    URL: http://localhost:8080/{short_id}
    ```
    –ù–∞—Å—Ç—Ä–æ–π–∫–∏: –í–∫–ª—é—á–∏—Ç–µ "Follow redirect" –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –∑–∞–ø—Ä–æ—Å–∞

- 3. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    –ú–µ—Ç–æ–¥: GET
    ```
    URL: http://localhost:8080/stats/{short_id}
    ```
## –ß–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä
- 1. –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ—Ä–æ—Ç–∫–æ–π —Å—Å—ã–ª–∫–∏
    –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ –≤–≤–µ–¥–∏—Ç–µ –≤ –∞–¥—Ä–µ—Å–Ω—É—é —Å—Ç—Ä–æ–∫—É:

    ```text
    http://localhost:8080/docs
    ```
    –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–Ω—Ç–µ—Ä—Ñ–∞–∫—Å Swagger UI –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API.


- 2. –ü–µ—Ä–µ—Ö–æ–¥ –ø–æ –∫–æ—Ä–æ—Ç–∫–æ–π —Å—Å—ã–ª–∫–µ
    –ü—Ä–æ—Å—Ç–æ –≤–≤–µ–¥–∏—Ç–µ –≤ –∞–¥—Ä–µ—Å–Ω—É—é —Å—Ç—Ä–æ–∫—É:

    ```
    http://localhost:8080/37fad5
    ```
    –ë—Ä–∞—É–∑–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç –≤–∞—Å –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π URL.



## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API
–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Swagger UI:
```
http://localhost:8080/docs
```

![–û–ø–∏—Å–∞–Ω–∏–µ](./assets/2025-12-18%20164636.jpg)

## –î–∞–Ω–Ω—ã–µ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö SQLite (urls.db) —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ Docker volume –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–∞–±–ª–∏—Ü—É:

```sql
CREATE TABLE urls (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    short_id TEXT UNIQUE NOT NULL,
    original_url TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    click_count INTEGER DEFAULT 0
);
```
–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö
```bash
docker exec shorturl_mw_task_final sqlite3 /app/data/urls.db "SELECT * FROM urls;"
```
![–û–ø–∏—Å–∞–Ω–∏–µ](./assets/2025-12-18%20165502.jpg)
## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º
### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
```bash
# –ó–∞–ø—É—Å–∫ —Å –ø–µ—Ä–µ—Å–±–æ—Ä–∫–æ–π
docker compose up --build

# –ó–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
docker compose up -d

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker compose down

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å —É–¥–∞–ª–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö
docker compose down -v

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker compose logs
docker compose logs -f  # –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
docker compose restart

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker compose ps

# –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker exec -it shorturl_mw_task_final bash
```